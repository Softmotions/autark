check {
  env.sh
}

set {
  CC
  ${CC cc}
}

set {
  CFLAGS
  ^{-DBUILD_TYPE= ${BUILD_TYPE}}
  if { eq { ${BUILD_TYPE} Release }
    -O2
  } else {
    -DDEBUG=1
    -O0
    -g
  }
  ..${CFLAGS}
}

set {
  LDFLAGS
  ..${LDFLAGS}
}

set {
  SOURCES
  main.c
  aux.c
}

cc {
  ${SOURCES}
  set { _ ${CFLAGS}  -I../libhello }
  ${CC}
}

include { ./libhello/Autark }

run {
  exec { ${CC} -static ${LDFLAGS} -o hello ${CC_OBJS} libhello/libhello.a }
  consumes {
    ${CC_OBJS}
    libhello/libhello.a
  }
  produces {
    hello
  }
}