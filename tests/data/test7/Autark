meta {
  name { Autark }
  description { Autark Test #7 }
  author { Adamansky Anton }
  website { https://autark.dev }
  sources { https://git.sr.ht/~adamansky/autark }
  license { MIT }
  version { 1.0.0 }
  let { GAZ ZAZ }
  let { BAR 'BAZ ZZ' }
}

check {
  env.sh
}

set {
  CC
  ${CC cc}
}

set {
  CFLAGS
  ^{-DBUILD_TYPE= ${BUILD_TYPE}}
  if { eq { ${BUILD_TYPE} Release }
    -O2
  } else {
    -DDEBUG=1
    -O0
    -g
  }
  ..${CFLAGS}
}

set {
  LDFLAGS
  ..${LDFLAGS}
}

set {
  SOURCES
  main.c
  aux.c
}

cc {
  ${SOURCES}
  set { _ ${CFLAGS}  -I./libhello }
  ${CC}
  consumes {
# The product of hello.h.in configure
    libhello/hello.h
  }
}

include { ./libhello/Autark }

run {
  exec { ${CC} ${LDFLAGS} -o hello ${CC_OBJS} libhello/libhello.a }
  consumes {
    ${CC_OBJS}
    libhello/libhello.a
  }
  produces {
    hello
  }
}