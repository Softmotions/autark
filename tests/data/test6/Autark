check {
  env.sh
}

set {
  CC
  ${CC cc}
}

set {
  CFLAGS
  ^{-DBUILD_TYPE= ${BUILD_TYPE}}
  ..@{pkgconf --cflags --static zlib}
  if { eq { ${BUILD_TYPE} Release }
    -O2
  } else {
    -DDEBUG=1
    -O0
    -g
  }
  ..${CFLAGS}
}

set {
  LDFLAGS
  ..@{pkgconf --libs --static zlib}
  ..${LDFLAGS}
}

set {
  SOURCES
  main.c
  hello.c
}

cc {
  ${SOURCES}
  ${CFLAGS}
  ${CC}
}

run {
  exec { ${CC} -o hello ${CC_OBJS} ${LDFLAGS}}
  shell { LC_ALL=C ls -al ./hello }
  consumes {
    ${CC_OBJS}
  }
  produces {
    hello
  }
}