check {
  env.sh
}

set {
  CC
  ${CC cc}
}

set {
  CFLAGS
  ^{-DBUILD_TYPE= ${BUILD_TYPE}}
  ..@{pkgconf --cflags --static libcurl}
  if { eq { ${BUILD_TYPE} Release }
    -O2
  } else {
    -DDEBUG=1
    -O0
    -g
  }
  ..${CFLAGS}
}

set {
  LDFLAGS
  ..${LDFLAGS}
  ..@{pkgconf --libs --static libcurl}
}

set {
  SOURCES
  main.c
  hello.c
}

cc {
  ${SOURCES}
  ${CFLAGS}
  ${CC}
}

run {
  exec { ${CC} -o hello ${CC_OBJS} ${LDFLAGS}}
  consumes {
    ${CC_OBJS}
  }
  products {
    hello
  }
}