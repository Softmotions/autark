set {
  TESTS
  in-sources {
    ..@{autark glob '*.c'}
  }
}

set {
  LIBAUTARK
  ../libautark.a
}

cc {
  ${TESTS}
  set { _ ${CFLAGS} -I S{} }
  ${CC}
}

foreach {
  OBJ
  ${CC_OBJS}
  run {
    exec { ${CC} ${OBJ} ${LIBAUTARK} -o %{${OBJ}} }
    produces {
      %{${OBJ}}
    }
    consumes {
      ${LIBAUTARK}
      ${OBJ}
    }
  }
}

# Run test cases
if { defined { RUN_TESTS }
  foreach {
    OBJ
    ${CC_OBJS}
    run {
      always
      shell { %{${OBJ}} }
      consumes { %{${OBJ}} }
    }
  }
}
